{"version":3,"sources":["../../../node_modules/browser-pack/_prelude.js","post.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","loadImages","data","esques","DocumentFragment","createEsque","allImages","querySelectorAll","imagesLoaded","container","document","querySelector","appendChild","Masonry","itemSelector","columnWidth","percentPosition","datum","fragment","newEsque","cloneNode","counter","heartFill","image","user","firstChild","setAttribute","_id","link","startsWith","src","substr","title","alt","textContent","linkerProfileImage","linkerScreenName","hearts","userHearted","classList","add","addEventListener","location","href","protocol","host","fetch","method","credentials","headers","Content-Type","body","JSON","stringify","id","then","res","json","toggle","catch","err","console","error","remove","Access-Control-Allow-Methods","message","parentNode","removeChild","window","onload","pathname","match"],"mappings":"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","file":"post.bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\nwindow.onload = function () {\n  if (!location.pathname.match(/^\\/addesque\\/?$/i)) {\n    fetch('/api/esques', { credentials: 'same-origin' })\n      .then(res => res.json())\n      .then(json => loadImages(json))\n      .catch(err => console.error(err));\n  }\n};\n\n// load images from json\nfunction loadImages (data) {\n  const esques = new DocumentFragment();\n\n  for (let i = 0; i < data.length; i++) {\n    createEsque(data[i], esques);\n  }\n\n  const allImages = esques.querySelectorAll('.esque__image, .esque__user');\n  imagesLoaded(allImages, () => {\n    const container = document.querySelector('.wrapper--esquewall');\n    container.appendChild(esques);\n\n    const msnry = new Masonry(container, {\n      itemSelector: '.masonry-element',\n      columnWidth: '.masonry-element-sizer',\n      percentPosition: true\n    });\n\n  });\n}\n\nfunction createEsque (datum, fragment) {\n  const newEsque = document.querySelector('.masonry-element').cloneNode(true);\n\n  const counter = newEsque.querySelector('.esque__counter');\n  const heartFill = newEsque.querySelector('.esque__heart--fill');\n  const image = newEsque.querySelector('.esque__image');\n  const user = newEsque.querySelector('.esque__user');\n\n  newEsque.firstChild.setAttribute('data-id', datum._id);\n\n  if (datum.link.startsWith('http://')) {\n    image.src = datum.link.substr(5);\n  }\n  else image.src = datum.link; \n\n  image.title = datum.title;\n  image.alt = datum.title;\n  newEsque.querySelector('.esque__title').textContent = datum.title;\n  user.src = datum.linkerProfileImage;\n  user.title = '@' + datum.linkerScreenName;\n  user.alt = '@' + datum.linkerScreenName;\n  counter.textContent = datum.hearts;\n\n  if (datum.userHearted) {\n    heartFill.classList.add('is-hearted');\n  }\n\n  user.addEventListener('click', () => {\n    location.href = `${location.protocol}//${location.host}/user/${datum.linkerScreenName}`;\n  });\n\n  // send: the id of the esque, the user can be inferred from the req itself.\n  newEsque.querySelector('.esque__favorite').addEventListener('click', () => {\n    fetch('/api/esques', { method: 'POST', credentials: 'same-origin' , headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id: datum._id }) })\n      .then(res => res.json())\n      .then(json => {\n        counter.textContent = json.hearts;\n        heartFill.classList.toggle('is-hearted');\n      })\n      .catch(err => console.error(err));\n  });\n\n\n  if (newEsque.querySelector('.esque__close')) { // or check if path is myesques\n    newEsque.querySelector('.esque').addEventListener('mouseover', () => {\n      newEsque.querySelector('.esque__close').classList.add('is-displayed');\n    });\n\n    newEsque.querySelector('.esque').addEventListener('mouseout', () => {\n      newEsque.querySelector('.esque__close').classList.remove('is-displayed');\n    });\n\n    newEsque.querySelector('.esque__close').addEventListener('click', () => {\n      fetch('/api/esques', { method: 'DELETE', credentials: 'same-origin', headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Methods': 'POST, GET, DELETE' }, body: JSON.stringify({ id: datum._id }) })\n        .then(res => res.json())\n        .then(json => {\n          // remove the entire element from the displayi\n          if (json.message === 'success') {\n            newEsque.parentNode.removeChild(newEsque);\n          }\n        })\n        .catch(err => console.error(err));\n    });\n  }\n\n  fragment.appendChild(newEsque);\n\n  \n\n  //document.querySelector('.wrapper--esques').insertBefore(newEsque, document.querySelector('.masonry-element-sizer'));\n  newEsque.classList.remove('is-not-displayed');\n}\n\n"]}