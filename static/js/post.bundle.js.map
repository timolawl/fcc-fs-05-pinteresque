{"version":3,"sources":["../../../node_modules/browser-pack/_prelude.js","post.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","loadImages","data","bricks","DocumentFragment","createBrick","allImages","querySelectorAll","imagesLoaded","container","document","querySelector","appendChild","Masonry","itemSelector","columnWidth","percentPosition","datum","fragment","newBrick","cloneNode","counter","heartFill","image","user","firstChild","setAttribute","_id","src","link","title","alt","textContent","linkerProfileImage","linkerScreenName","hearts","userHearted","classList","add","addEventListener","location","href","protocol","host","fetch","method","credentials","headers","Content-Type","body","JSON","stringify","id","then","res","json","toggle","catch","err","console","error","remove","Access-Control-Allow-Methods","message","parentNode","removeChild","window","onload","pathname","match"],"mappings":"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","file":"post.bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","'use strict';\n\nwindow.onload = function () {\n  if (!location.pathname.match(/^\\/addbrick\\/?$/i)) {\n    fetch('/api/bricks', { credentials: 'same-origin' })\n      .then(res => res.json())\n      .then(json => loadImages(json))\n      .catch(err => console.error(err));\n  }\n};\n\n// load images from json\nfunction loadImages (data) {\n  const bricks = new DocumentFragment();\n\n  for (let i = 0; i < data.length; i++) {\n    createBrick(data[i], bricks);\n  }\n\n  const allImages = bricks.querySelectorAll('.brick__image, .brick__user');\n  imagesLoaded(allImages, () => {\n    const container = document.querySelector('.wrapper--bricks');\n    container.appendChild(bricks);\n\n    const msnry = new Masonry(container, {\n      itemSelector: '.masonry-element',\n      columnWidth: '.masonry-element-sizer',\n      percentPosition: true\n    });\n\n  });\n}\n\nfunction createBrick (datum, fragment) {\n  const newBrick = document.querySelector('.masonry-element').cloneNode(true);\n\n  const counter = newBrick.querySelector('.brick__counter');\n  const heartFill = newBrick.querySelector('.brick__heart--fill');\n  const image = newBrick.querySelector('.brick__image');\n  const user = newBrick.querySelector('.brick__user');\n\n  newBrick.firstChild.setAttribute('data-id', datum._id);\n  image.src = datum.link;\n  image.title = datum.title;\n  image.alt = datum.title;\n  newBrick.querySelector('.brick__title').textContent = datum.title;\n  user.src = datum.linkerProfileImage;\n  user.title = '@' + datum.linkerScreenName;\n  user.alt = '@' + datum.linkerScreenName;\n  counter.textContent = datum.hearts;\n\n  if (datum.userHearted) {\n    heartFill.classList.add('is-hearted');\n  }\n\n  user.addEventListener('click', () => {\n    location.href = `${location.protocol}//${location.host}/user/${datum.linkerScreenName}`;\n  });\n\n  // send: the id of the brick, the user can be inferred from the req itself.\n  newBrick.querySelector('.brick__favorite').addEventListener('click', () => {\n    fetch('/api/bricks', { method: 'POST', credentials: 'same-origin' , headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ id: datum._id }) })\n      .then(res => res.json())\n      .then(json => {\n        counter.textContent = json.hearts;\n        heartFill.classList.toggle('is-hearted');\n      })\n      .catch(err => console.error(err));\n  });\n\n\n  if (newBrick.querySelector('.brick__close')) { // or check if path is mybricks\n    newBrick.querySelector('.brick').addEventListener('mouseover', () => {\n      newBrick.querySelector('.brick__close').classList.add('is-displayed');\n    });\n\n    newBrick.querySelector('.brick').addEventListener('mouseout', () => {\n      newBrick.querySelector('.brick__close').classList.remove('is-displayed');\n    });\n\n    newBrick.querySelector('.brick__close').addEventListener('click', () => {\n      fetch('/api/bricks', { method: 'DELETE', credentials: 'same-origin', headers: { 'Content-Type': 'application/json', 'Access-Control-Allow-Methods': 'POST, GET, DELETE' }, body: JSON.stringify({ id: datum._id }) })\n        .then(res => res.json())\n        .then(json => {\n          // remove the entire element from the displayi\n          if (json.message === 'success') {\n            newBrick.parentNode.removeChild(newBrick);\n          }\n        })\n        .catch(err => console.error(err));\n    });\n  }\n\n  fragment.appendChild(newBrick);\n\n  \n\n  //document.querySelector('.wrapper--bricks').insertBefore(newBrick, document.querySelector('.masonry-element-sizer'));\n  newBrick.classList.remove('is-not-displayed');\n}\n\n"]}